// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  //output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  //id           Int      @id @default(autoincrement())
  clerkId      String   @unique  // ID que Clerk te da
  nombre       String?
  apellidos    String?
  email        String?  
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  asignaturas Asignatura[]
}

model Asignatura{
  id String @id @default(uuid()) @db.Uuid
  user_id String
  nombre String
  descripcion String?
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  // relación uno-a-muchos con partesExamen
  examenes Examen[]
  user Usuario @relation(fields: [user_id], references: [clerkId], onDelete: Cascade)
}

enum Convocatoria{
  Febrero
  Junio
  Septiembre
  Diciembre
}

model Examen {
  id String @id @default(uuid()) @db.Uuid
  id_asign String @db.Uuid
  partes Int
  convocatoria Convocatoria 
  fecha_examen DateTime
  n_present Int @default(0)
  n_esperados Int 
  n_aprobados Int @default(0)
  duracion_h Int
  duracion_m  Int

  finalizado Boolean @default(false)
  
  created_at  DateTime @default(now())
  updated_at DateTime @updatedAt

  // relación uno-a-muchos con partesExamen
  partesExamen partesExamen[]
  // FK hacia asignatura
  asignatura Asignatura @relation(fields: [id_asign], references: [id], onDelete: Cascade)
  // Aulas - alumnos esperados
  aulaAlumnos AulaAlumnos[]
}

model AulaAlumnos {
  id String @id @default(uuid()) @db.Uuid

  aula String
  n_esperados Int

  created_at  DateTime @default(now())
  updated_at DateTime @updatedAt

  examen    Examen   @relation(fields: [examenId], references: [id], onDelete: Cascade)
  examenId  String @db.Uuid
}

model partesExamen{
  id String @id @default(uuid()) @db.Uuid
  id_examen String @db.Uuid
  nombre String
  num_parte Int
  duracion_h Int
  duracion_m Int
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  // FK hacia examen
  examen Examen @relation(fields: [id_examen], references: [id], onDelete: Cascade)
}
